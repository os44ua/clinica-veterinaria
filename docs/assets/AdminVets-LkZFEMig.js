import{u as W,r as o,h as B,k as P,i as v,j as e,G,H as q}from"./index-DLtPwF8f.js";import{d as z}from"./dog-DqB3gY0C.js";const i={CLIENTE:"CLIENTE",VETERINARIO:"VETERINARIO",ADMIN:"ADMIN"};function K(){const{t:s}=W(),[h,b]=o.useState([]),[T,w]=o.useState(!0),[p,E]=o.useState(!1),[I,g]=o.useState(""),[C,u]=o.useState(""),[c,m]=o.useState([]),[j,R]=o.useState(!1),[S,k]=o.useState(new Set),N=B();o.useEffect(()=>{D()},[]);const D=async(t=!1)=>{try{t?E(!0):w(!0);const n=await P(v(N,"users"));if(n.exists()){const l=n.val(),a=Object.keys(l).map(r=>({uid:r,email:l[r].email||"(sin email)",roles:l[r].roles||{}}));b(a)}else b([]);m([]),g("")}catch(n){console.error("Error al cargar usuarios:",n),g(s("admin.loadError"))}finally{w(!1),E(!1)}},M=()=>{D(!0)},y=t=>t!=null&&t.admin?i.ADMIN:t!=null&&t.veterinario?i.VETERINARIO:i.CLIENTE,O=(t,n)=>{const l=h.find(r=>r.uid===t);if(!l)return;const a=y(l.roles);if(n===a){m(r=>r.filter(d=>d.uid!==t));return}m(r=>{const d=r.findIndex(f=>f.uid===t),x={uid:t,newRole:n,currentRole:a};if(d>=0){const f=[...r];return f[d]=x,f}else return[...r,x]})},V=async()=>{if(c.length===0)return;R(!0);let t=0;try{for(const n of c){const l={admin:n.newRole===i.ADMIN,veterinario:n.newRole===i.VETERINARIO,cliente:!0};await G(v(N,`users/${n.uid}/roles`),l),b(a=>a.map(r=>r.uid===n.uid?{...r,roles:l}:r)),t++}m([]),u(s("admin.changesSaved",{count:t})),setTimeout(()=>u(""),4e3)}catch(n){console.error("Error al guardar cambios:",n),g(s("admin.saveChangesError"))}finally{R(!1)}},U=()=>{m([])},$=async(t,n)=>{if(window.confirm(`${s("admin.confirmDelete",{email:n})}?`)){k(a=>new Set(a).add(t));try{await q(v(N,`users/${t}`)),b(a=>a.filter(r=>r.uid!==t)),m(a=>a.filter(r=>r.uid!==t)),u(s("admin.userDeleted",{email:n})),setTimeout(()=>u(""),3e3)}catch(a){console.error("Error al eliminar usuario:",a),g(s("admin.deleteError",{email:n}))}finally{k(a=>{const r=new Set(a);return r.delete(t),r})}}},H=t=>{const n=c.find(a=>a.uid===t);if(n)return n.newRole;const l=h.find(a=>a.uid===t);return l?y(l.roles):i.CLIENTE},L=t=>{switch(t){case i.ADMIN:return s("admin.roles.admin");case i.VETERINARIO:return s("admin.roles.vet");case i.CLIENTE:return s("admin.roles.client");default:return s("admin.roles.unknown")}},A=()=>{g(""),u("")};return T?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 to-blue-100 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),e.jsx("p",{className:"text-gray-600",children:s("admin.loading")})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 to-blue-100 py-8 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8 mb-8",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:z,alt:"Admin Logo",className:"w-12 h-12 object-contain mr-4"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:s("admin.title")}),e.jsx("p",{className:"text-gray-600",children:s("admin.description")})]})]})}),C&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("p",{className:"text-sm",children:C})]}),e.jsx("button",{onClick:A,className:"text-green-500 hover:text-green-700 font-semibold",children:s("forms.close")})]})}),I&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s("errors.somethingWrong")}),e.jsx("p",{className:"text-sm mt-1",children:I})]}),e.jsx("button",{onClick:A,className:"text-red-500 hover:text-red-700 font-semibold",children:s("forms.close")})]})}),c.length>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s("admin.pendingChanges",{count:c.length})}),e.jsx("p",{className:"text-sm mt-1",children:s("admin.pendingChangesDesc")})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:U,className:"px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300",children:s("forms.cancel")}),e.jsxs("button",{onClick:V,disabled:j,className:"px-3 py-1 bg-yellow-600 text-white rounded text-sm hover:bg-yellow-700 disabled:opacity-50 flex items-center space-x-1",children:[j&&e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-white border-t-transparent"}),e.jsx("span",{children:s(j?"forms.saving":"admin.saveChanges")})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:[s("admin.usersList")," (",h.length,")"]}),e.jsxs("button",{onClick:M,disabled:p,className:"btn-primary flex items-center space-x-2",children:[e.jsx("svg",{className:`w-4 h-4 ${p?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:s(p?"admin.updating":"admin.refresh")})]})]}),h.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:s("admin.noUsers")})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gradient-to-r from-cyan-50 to-blue-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider border-b-2 border-gray-200 w-2/5",children:s("admin.table.user")}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-bold text-gray-700 uppercase tracking-wider border-b-2 border-gray-200 w-1/5",children:s("admin.table.currentRole")}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-bold text-gray-700 uppercase tracking-wider border-b-2 border-gray-200 w-1/5",children:s("admin.table.changeRole")}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-bold text-gray-700 uppercase tracking-wider border-b-2 border-gray-200 w-1/5",children:s("admin.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:h.map((t,n)=>{const l=y(t.roles),a=H(t.uid),r=c.some(x=>x.uid===t.uid),d=S.has(t.uid);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",style:{animationDelay:`${n*.1}s`},children:[e.jsx("td",{className:"px-6 py-4 border-r border-gray-100",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-gray-900 text-base",children:t.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"ID:"})," ",t.uid.substring(0,8),"..."]})]})}),e.jsx("td",{className:"px-6 py-4 text-center border-r border-gray-100",children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full ${l===i.ADMIN?"bg-red-100 text-red-800":l===i.VETERINARIO?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:L(l)}),r&&e.jsxs("div",{className:"flex items-center text-xs text-yellow-600 font-medium",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})}),L(a)]})]})}),e.jsx("td",{className:"px-6 py-4 text-center border-r border-gray-100",children:e.jsxs("select",{value:a,onChange:x=>O(t.uid,x.target.value),disabled:d,className:`w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 ${r?"border-yellow-400 bg-yellow-50 shadow-md":"bg-white shadow-sm"}`,children:[e.jsx("option",{value:i.CLIENTE,children:s("admin.roles.client")}),e.jsx("option",{value:i.VETERINARIO,children:s("admin.roles.vet")}),e.jsx("option",{value:i.ADMIN,children:s("admin.roles.admin")})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("button",{onClick:()=>$(t.uid,t.email),disabled:d,className:"px-4 py-2 text-sm font-medium rounded-lg bg-red-500 text-white hover:bg-red-600 transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 mx-auto",children:[d?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:s(d?"forms.deleting":"forms.delete")})]})})]},t.uid)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mt-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:s("admin.rolesInfo.title")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:s("admin.roles.client")}),e.jsx("p",{className:"text-sm text-green-700",children:s("admin.rolesInfo.clientDesc")})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:s("admin.roles.vet")}),e.jsx("p",{className:"text-sm text-blue-700",children:s("admin.rolesInfo.vetDesc")})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:s("admin.roles.admin")}),e.jsx("p",{className:"text-sm text-red-700",children:s("admin.rolesInfo.adminDesc")})]})]})]})]})})}export{K as default};
