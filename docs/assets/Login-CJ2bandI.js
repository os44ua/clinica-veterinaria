import{u as R,r as d,a as L,b as A,c as I,l as t,d as h,j as e,R as b,e as C}from"./index-DLtPwF8f.js";import{d as S}from"./dog-DqB3gY0C.js";const V=()=>{const{t:r}=R(),[n,j]=d.useState(""),[c,v]=d.useState(""),[f,s]=d.useState(""),o=L(),{loginLoading:i,error:g,isAuthenticated:x,roles:u}=A(),m=I(),p=a=>{t.info(`Redirigiendo usuario con roles: ${a.join(", ")}`),a.includes(b.ADMIN)?(t.info("Redirigiendo a panel admin"),m("/adminvets")):a.includes(b.VETERINARIO)?(t.info("Redirigiendo a panel veterinario"),m("/perfilveterinario")):(t.info("Redirigiendo a panel cliente"),m("/perfilcliente"))};d.useEffect(()=>{x&&u&&u.length>0&&(t.info("Usuario ya autenticado, redirigiendo automáticamente"),p(u))},[x,u]),d.useEffect(()=>()=>{o(h())},[o]);const N=()=>(s(""),n.trim()?n.includes("@")?c.trim()?c.length<6?(s(r("auth.passwordMinLength")),!1):!0:(s(r("auth.passwordRequired")),!1):(s(r("auth.emailInvalid")),!1):(s(r("auth.emailRequired")),!1)),y=async a=>{if(a.preventDefault(),s(""),o(h()),!N()){t.warn("Validación de formulario falló");return}t.info(`Intentando login para: ${n}`);try{const l=await o(C({email:n,password:c})).unwrap();t.info("Login exitoso"),t.info("Resultado del login:"),l&&l.roles&&l.roles.length>0?(t.info("Redirigiendo según roles obtenidos"),p(l.roles)):(t.error("No se obtuvieron roles válidos del login"),s("Error: No se pudieron cargar los roles del usuario"))}catch(l){t.error(`Login falló con error: ${l}`)}},w=()=>{s(""),o(h())},E=()=>{i||(t.info("Navegando a página de registro"),m("/register"))};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 to-blue-100 flex items-center justify-center px-4 py-10",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx("img",{src:S,alt:"Veterinary Clinic Logo",className:"w-16 h-16 object-contain"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:r("auth.loginTitle")}),e.jsx("p",{className:"text-gray-600 mt-2",children:r("auth.loginSubtitle")})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[(g||f)&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:r("auth.loginError")}),e.jsx("p",{className:"text-sm mt-1",children:f||g})]}),e.jsx("button",{type:"button",onClick:w,className:"text-red-600 hover:text-red-800 ml-2",children:"×"})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:r("auth.email")}),e.jsx("input",{id:"email",type:"email",value:n,onChange:a=>j(a.target.value),required:!0,placeholder:r("auth.emailPlaceholder"),disabled:i,className:"form-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:r("auth.password")}),e.jsx("input",{id:"password",type:"password",value:c,onChange:a=>v(a.target.value),required:!0,placeholder:r("auth.passwordPlaceholder"),disabled:i,className:"form-input"})]}),e.jsx("button",{type:"submit",disabled:i,className:"btn-primary w-full py-3 text-lg",children:i?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"}),r("auth.logging")]}):r("auth.loginButton")}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[r("auth.noAccount")," ",e.jsx("button",{type:"button",onClick:E,disabled:i,className:"text-cyan-500 hover:text-cyan-600 underline font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:r("auth.registerLink")})]})})]})]})})};export{V as default};
